<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test CarbonPilot Backend</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .container { max-width: 800px; margin: 0 auto; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .loading { background-color: #fff3cd; border-color: #ffeaa7; }
        button { padding: 10px 20px; margin: 10px 5px; cursor: pointer; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🧪 Test CarbonPilot Backend</h1>
        <p>Questa pagina testa se il backend è funzionante e se gli endpoint sono accessibili.</p>
        
        <div id="backend-status" class="test-section loading">
            <h3>📡 Status Backend</h3>
            <p id="backend-result">Controllo in corso...</p>
        </div>
        
        <div id="batch-test" class="test-section loading">
            <h3>📦 Test Endpoint Batch</h3>
            <p id="batch-result">Controllo in corso...</p>
        </div>
        
        <div id="batch-specific" class="test-section loading">
            <h3>🎯 Test Batch Specifico</h3>
            <p id="specific-result">Controllo in corso...</p>
        </div>
        
        <div class="test-section">
            <h3>🔧 Azioni Manuali</h3>
            <button onclick="testBackend()">🔄 Riprova Test Backend</button>
            <button onclick="testBatchEndpoint()">📦 Test Endpoint Batch</button>
            <button onclick="testSpecificBatch()">🎯 Test Batch Esistente</button>
        </div>
        
        <div id="debug-info" class="test-section">
            <h3>🐛 Debug Info</h3>
            <pre id="debug-output">Nessun debug disponibile</pre>
        </div>
    </div>

    <script>
        const BACKEND_URL = 'http://localhost:8000';
        const EXISTING_BATCH_ID = '83e35d31-0d35-4c55-bf22-f2b0bf38b0bf';
        
        function updateStatus(elementId, status, message, data = null) {
            const element = document.getElementById(elementId);
            element.className = `test-section ${status}`;
            element.querySelector('p').innerHTML = message;
            
            if (data) {
                document.getElementById('debug-output').textContent = JSON.stringify(data, null, 2);
            }
        }
        
        async function testBackend() {
            updateStatus('backend-status', 'loading', 'Testando connessione backend...');
            
            try {
                const response = await fetch(`${BACKEND_URL}/docs`);
                if (response.ok) {
                    updateStatus('backend-status', 'success', '✅ Backend attivo e raggiungibile!');
                } else {
                    updateStatus('backend-status', 'error', `❌ Backend risponde con errore: ${response.status}`);
                }
            } catch (error) {
                updateStatus('backend-status', 'error', `❌ Errore connessione backend: ${error.message}`);
            }
        }
        
        async function testBatchEndpoint() {
            updateStatus('batch-test', 'loading', 'Testando endpoint lista batch...');
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/batch_nesting?limit=3`);
                if (response.ok) {
                    const data = await response.json();
                    updateStatus('batch-test', 'success', `✅ Endpoint batch funziona! Trovati ${data.length} batch`, data);
                } else {
                    updateStatus('batch-test', 'error', `❌ Endpoint batch errore: ${response.status}`);
                }
            } catch (error) {
                updateStatus('batch-test', 'error', `❌ Errore endpoint batch: ${error.message}`);
            }
        }
        
        async function testSpecificBatch() {
            updateStatus('batch-specific', 'loading', 'Testando batch specifico...');
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/batch_nesting/result/${EXISTING_BATCH_ID}?multi=true`);
                if (response.ok) {
                    const data = await response.json();
                    updateStatus('batch-specific', 'success', `✅ Batch specifico funziona! Trovati ${data.total_batches} batch correlati`, data);
                } else {
                    updateStatus('batch-specific', 'error', `❌ Batch specifico errore: ${response.status}`);
                }
            } catch (error) {
                updateStatus('batch-specific', 'error', `❌ Errore batch specifico: ${error.message}`);
            }
        }
        
        // Avvia i test automaticamente
        window.onload = async function() {
            await testBackend();
            await new Promise(resolve => setTimeout(resolve, 1000));
            await testBatchEndpoint();
            await new Promise(resolve => setTimeout(resolve, 1000));
            await testSpecificBatch();
        };
    </script>
</body>
</html> 