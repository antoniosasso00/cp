(()=>{var e={};e.id=234,e.ids=[234],e.modules={5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},1877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},5319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},9491:e=>{"use strict";e.exports=require("assert")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},7147:e=>{"use strict";e.exports=require("fs")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},2037:e=>{"use strict";e.exports=require("os")},1017:e=>{"use strict";e.exports=require("path")},2781:e=>{"use strict";e.exports=require("stream")},6224:e=>{"use strict";e.exports=require("tty")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},1905:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>l.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>d,routeModule:()=>m,tree:()=>c});var s=t(7096),i=t(6132),a=t(7284),l=t.n(a),n=t(2564),o={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>n[e]);t.d(r,o);let c=["",{children:["dashboard",{children:["parts",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,5701)),"C:\\Users\\Anton\\Documents\\CarbonPilot\\frontend\\src\\app\\dashboard\\parts\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,8182)),"C:\\Users\\Anton\\Documents\\CarbonPilot\\frontend\\src\\app\\dashboard\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,605)),"C:\\Users\\Anton\\Documents\\CarbonPilot\\frontend\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,9291,23)),"next/dist/client/components/not-found-error"]}],d=["C:\\Users\\Anton\\Documents\\CarbonPilot\\frontend\\src\\app\\dashboard\\parts\\page.tsx"],u="/dashboard/parts/page",p={require:t,loadChunk:()=>Promise.resolve()},m=new s.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/dashboard/parts/page",pathname:"/dashboard/parts",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},5520:(e,r,t)=>{Promise.resolve().then(t.bind(t,1339))},1339:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>v});var s=t(3854),i=t(4218),a=t(2416),l=t(9924),n=t(3110),o=t(2096),c=t(2496),d=t(2828),u=t(1460),p=t(8521),m=t(9589);let x=u.z.object({part_number:u.z.string().min(1,"Part Number obbligatorio"),descrizione_breve:u.z.string().min(1,"Descrizione obbligatoria"),num_valvole_richieste:u.z.number().min(1,"Almeno una valvola richiesta"),note_produzione:u.z.string().optional().nullable(),ciclo_cura_id:u.z.number().optional().nullable(),tool_ids:u.z.array(u.z.number()).optional().default([])});function h({isOpen:e,onClose:r,onSuccess:t,item:o}){let[c,h]=(0,i.useState)({part_number:"",descrizione_breve:"",num_valvole_richieste:1,note_produzione:null,ciclo_cura_id:null,tool_ids:[]}),[v,_]=(0,i.useState)({}),[g,b]=(0,i.useState)(!1),[j,N]=(0,i.useState)([]),[f,z]=(0,i.useState)([]),[y,C]=(0,i.useState)([]),[P,w]=(0,i.useState)(!1),{toast:S}=(0,a.p)(),q=async()=>{w(!0);try{let[e,r,t]=await Promise.all([d.NN.getAll({attivo:!0}),d.UK.getAll(),d.iE.getAll()]);N(e.map(e=>({value:e.part_number,label:`${e.part_number} - ${e.descrizione}`,categoria:e.categoria}))),z(r),C(t)}catch(e){console.error("Errore nel caricamento delle opzioni:",e),S({variant:"destructive",title:"Errore",description:"Impossibile caricare le opzioni. Riprova pi\xf9 tardi."})}finally{w(!1)}};(0,i.useEffect)(()=>{e&&q()},[e]),(0,i.useEffect)(()=>{o?h({part_number:o.part_number,descrizione_breve:o.descrizione_breve,num_valvole_richieste:o.num_valvole_richieste,note_produzione:o.note_produzione||null,ciclo_cura_id:o.ciclo_cura?.id||null,tool_ids:o.tools?.map(e=>e.id)||[]}):h({part_number:"",descrizione_breve:"",num_valvole_richieste:1,note_produzione:null,ciclo_cura_id:null,tool_ids:[]}),_({})},[o,e]);let E=(e,r)=>{h(t=>({...t,[e]:r})),v[e]&&_(r=>{let t={...r};return delete t[e],t})},A=()=>{try{let e={...c,num_valvole_richieste:Number(c.num_valvole_richieste),ciclo_cura_id:null!==c.ciclo_cura_id?Number(c.ciclo_cura_id):null,tool_ids:c.tool_ids||[]};return x.parse(e),{valid:!0,errors:{}}}catch(e){if(e instanceof u.z.ZodError){let r={};return e.errors.forEach(e=>{e.path[0]&&(r[e.path[0].toString()]=e.message)}),{valid:!1,errors:r}}return{valid:!1,errors:{form:"Errore di validazione"}}}},k=async()=>{let e=A();if(!e.valid){_(e.errors);return}let r={part_number:c.part_number,descrizione_breve:c.descrizione_breve,num_valvole_richieste:Number(c.num_valvole_richieste),tool_ids:c.tool_ids};c.note_produzione&&(r.note_produzione=c.note_produzione),null!==c.ciclo_cura_id&&(r.ciclo_cura_id=Number(c.ciclo_cura_id)),b(!0);try{o?(await d.os.update(o.id,r),S({variant:"success",title:"Aggiornato",description:`Parte con ID ${o.id} aggiornata con successo.`})):(await d.os.create(r),S({variant:"success",title:"Creato",description:"Nuova parte creata con successo."})),t()}catch(r){console.error("Errore durante il salvataggio:",r);let e="Si \xe8 verificato un errore durante il salvataggio.";r instanceof Error&&(e=r.message),S({variant:"destructive",title:"Errore",description:e})}finally{b(!1)}};return s.jsx(p.Vq,{open:e,onOpenChange:r,children:(0,s.jsxs)(p.cZ,{className:"sm:max-w-[600px]",children:[s.jsx(p.fK,{children:s.jsx(p.$N,{children:o?`Modifica Parte: ${o.id}`:"Crea Nuova Parte"})}),(0,s.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[s.jsx(m._,{htmlFor:"part_number",className:"text-right",children:"Part Number"}),(0,s.jsxs)("div",{className:"col-span-3",children:[(0,s.jsxs)("select",{id:"part_number",value:c.part_number,onChange:e=>E("part_number",e.target.value),disabled:!!o||P,className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[s.jsx("option",{value:"",children:"Seleziona Part Number"}),j.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))]}),v.part_number&&s.jsx("p",{className:"text-sm text-destructive mt-1",children:v.part_number})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[s.jsx(m._,{htmlFor:"descrizione_breve",className:"text-right",children:"Descrizione"}),s.jsx(n.I,{id:"descrizione_breve",value:c.descrizione_breve,onChange:e=>E("descrizione_breve",e.target.value),className:"col-span-3"}),v.descrizione_breve&&s.jsx("p",{className:"col-span-4 text-right text-sm text-destructive",children:v.descrizione_breve})]}),(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[s.jsx(m._,{htmlFor:"num_valvole_richieste",className:"text-right",children:"Valvole"}),s.jsx(n.I,{id:"num_valvole_richieste",type:"number",min:"1",value:c.num_valvole_richieste,onChange:e=>E("num_valvole_richieste",e.target.value?Number(e.target.value):1),className:"col-span-3"}),v.num_valvole_richieste&&s.jsx("p",{className:"col-span-4 text-right text-sm text-destructive",children:v.num_valvole_richieste})]}),(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[s.jsx(m._,{htmlFor:"ciclo_cura_id",className:"text-right",children:"Ciclo di Cura"}),s.jsx("div",{className:"col-span-3",children:(0,s.jsxs)("select",{id:"ciclo_cura_id",value:null!==c.ciclo_cura_id?c.ciclo_cura_id:"",onChange:e=>E("ciclo_cura_id",e.target.value?Number(e.target.value):null),className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",disabled:P,children:[s.jsx("option",{value:"",children:"Nessun ciclo di cura"}),y.map(e=>s.jsx("option",{value:e.id,children:e.nome},e.id))]})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-4 items-start gap-4",children:[s.jsx(m._,{htmlFor:"tool_ids",className:"text-right pt-2",children:"Tools/Stampi"}),s.jsx("div",{className:"col-span-3",children:s.jsx("div",{className:"p-2 border rounded-md max-h-40 overflow-y-auto",children:0===f.length?s.jsx("p",{className:"text-sm text-muted-foreground",children:"Nessun tool disponibile"}):f.map(e=>(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx("input",{type:"checkbox",id:`tool-${e.id}`,checked:c.tool_ids.includes(e.id),onChange:r=>{let t=[...c.tool_ids],s=r.target.checked?[...t,e.id]:t.filter(r=>r!==e.id);E("tool_ids",s)},disabled:P,className:"h-4 w-4 rounded border-gray-300"}),(0,s.jsxs)("label",{htmlFor:`tool-${e.id}`,className:"text-sm",children:[e.codice," ",e.descrizione&&`- ${e.descrizione}`]})]},e.id))})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[s.jsx(m._,{htmlFor:"note_produzione",className:"text-right",children:"Note Produzione"}),s.jsx("textarea",{id:"note_produzione",value:c.note_produzione||"",onChange:e=>E("note_produzione",e.target.value||null),className:"col-span-3 flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm",placeholder:"Note opzionali sulla produzione"})]})]}),(0,s.jsxs)(p.cN,{children:[s.jsx(l.z,{type:"button",variant:"outline",onClick:r,disabled:g||P,children:"Annulla"}),s.jsx(l.z,{type:"button",onClick:k,disabled:g||P,children:g?"Salvataggio...":o?"Aggiorna":"Crea"})]})]})})}function v(){let[e,r]=(0,i.useState)([]),[t,u]=(0,i.useState)(!0),[p,m]=(0,i.useState)(""),[x,v]=(0,i.useState)({}),[_,g]=(0,i.useState)(!1),[b,j]=(0,i.useState)(null),{toast:N}=(0,a.p)(),f=async()=>{try{u(!0);let e=await d.os.getAll(x);r(e)}catch(e){console.error("Errore nel caricamento delle parti:",e),N({variant:"destructive",title:"Errore",description:"Impossibile caricare le parti. Riprova pi\xf9 tardi."})}finally{u(!1)}};(0,i.useEffect)(()=>{f()},[x]);let z=e=>{j(e),g(!0)},y=async e=>{if(window.confirm(`Sei sicuro di voler eliminare la parte con ID ${e}?`))try{await d.os.delete(e),N({variant:"success",title:"Eliminata",description:`Parte con ID ${e} eliminata con successo.`}),f()}catch(r){console.error(`Errore durante l'eliminazione della parte ${e}:`,r),N({variant:"destructive",title:"Errore",description:`Impossibile eliminare la parte con ID ${e}.`})}},C=e.filter(e=>{let r=p.toLowerCase();return e.part_number.toLowerCase().includes(r)||e.descrizione_breve.toLowerCase().includes(r)});return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[s.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Parti"}),s.jsx("p",{className:"text-muted-foreground",children:"Gestisci le parti in produzione"})]}),s.jsx(l.z,{onClick:()=>{j(null),g(!0)},children:"Nuova Parte"})]}),s.jsx("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:s.jsx(n.I,{placeholder:"Cerca nelle parti...",value:p,onChange:e=>m(e.target.value),className:"max-w-sm"})}),t?s.jsx("div",{className:"flex justify-center py-8",children:s.jsx("p",{children:"Caricamento in corso..."})}):(0,s.jsxs)(o.iA,{children:[s.jsx(o.Rn,{children:"Lista delle parti in produzione"}),s.jsx(o.xD,{children:(0,s.jsxs)(o.SC,{children:[s.jsx(o.ss,{children:"ID"}),s.jsx(o.ss,{children:"Part Number"}),s.jsx(o.ss,{children:"Descrizione"}),s.jsx(o.ss,{className:"text-center",children:"Valvole"}),s.jsx(o.ss,{children:"Tools"}),s.jsx(o.ss,{className:"text-right",children:"Azioni"})]})}),s.jsx(o.RM,{children:0===C.length?s.jsx(o.SC,{children:s.jsx(o.pj,{colSpan:6,className:"text-center py-8",children:"Nessuna parte trovata"})}):C.map(e=>(0,s.jsxs)(o.SC,{children:[s.jsx(o.pj,{className:"font-medium",children:e.id}),s.jsx(o.pj,{children:e.part_number}),s.jsx(o.pj,{className:"max-w-xs truncate",children:e.descrizione_breve}),s.jsx(o.pj,{className:"text-center",children:e.num_valvole_richieste}),s.jsx(o.pj,{children:e.tools.length>0?s.jsx("div",{className:"flex flex-wrap gap-1",children:e.tools.map(e=>s.jsx(c.C,{variant:"secondary",className:"mr-1",children:e.codice},e.id))}):"-"}),s.jsx(o.pj,{className:"text-right",children:(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[s.jsx(l.z,{variant:"outline",size:"sm",onClick:()=>z(e),children:"Modifica"}),s.jsx(l.z,{variant:"destructive",size:"sm",onClick:()=>y(e.id),children:"Elimina"})]})})]},e.id))})]}),s.jsx(h,{isOpen:_,onClose:()=>g(!1),item:b,onSuccess:()=>{f(),g(!1)}})]})}},5701:(e,r,t)=>{"use strict";t.r(r),t.d(r,{$$typeof:()=>l,__esModule:()=>a,default:()=>o});var s=t(5153);let i=(0,s.createProxy)(String.raw`C:\Users\Anton\Documents\CarbonPilot\frontend\src\app\dashboard\parts\page.tsx`),{__esModule:a,$$typeof:l}=i,n=i.default,o=n}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[926,642,703,460,694],()=>t(1905));module.exports=s})();