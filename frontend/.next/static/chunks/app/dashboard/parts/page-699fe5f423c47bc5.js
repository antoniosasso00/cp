(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[234],{5318:function(e,i,r){Promise.resolve().then(r.bind(r,5029))},5029:function(e,i,r){"use strict";r.r(i),r.d(i,{default:function(){return N}});var s=r(7437),a=r(2265),t=r(4622),l=r(3089),n=r(6582),c=r(5271),o=r(150),d=r(6454),u=r(4578),m=r(1472),h=r(6429);let p=u.z.object({part_number:u.z.string().min(1,"Part Number obbligatorio"),descrizione_breve:u.z.string().min(1,"Descrizione obbligatoria"),num_valvole_richieste:u.z.number().min(1,"Almeno una valvola richiesta"),note_produzione:u.z.string().optional().nullable(),ciclo_cura_id:u.z.number().optional().nullable(),tool_ids:u.z.array(u.z.number()).optional().default([])});function x(e){let{isOpen:i,onClose:r,onSuccess:c,item:o}=e,[x,v]=(0,a.useState)({part_number:"",descrizione_breve:"",num_valvole_richieste:1,note_produzione:null,ciclo_cura_id:null,tool_ids:[]}),[_,j]=(0,a.useState)({}),[g,b]=(0,a.useState)(!1),[N,f]=(0,a.useState)([]),[z,C]=(0,a.useState)([]),[y,w]=(0,a.useState)([]),[S,E]=(0,a.useState)(!1),{toast:k}=(0,t.p)(),P=async()=>{E(!0);try{let[e,i,r]=await Promise.all([d.NN.getAll({attivo:!0}),d.UK.getAll(),d.iE.getAll()]);f(e.map(e=>({value:e.part_number,label:"".concat(e.part_number," - ").concat(e.descrizione),categoria:e.categoria}))),C(i),w(r)}catch(e){console.error("Errore nel caricamento delle opzioni:",e),k({variant:"destructive",title:"Errore",description:"Impossibile caricare le opzioni. Riprova pi\xf9 tardi."})}finally{E(!1)}};(0,a.useEffect)(()=>{i&&P()},[i]),(0,a.useEffect)(()=>{if(o){var e,i;v({part_number:o.part_number,descrizione_breve:o.descrizione_breve,num_valvole_richieste:o.num_valvole_richieste,note_produzione:o.note_produzione||null,ciclo_cura_id:(null===(e=o.ciclo_cura)||void 0===e?void 0:e.id)||null,tool_ids:(null===(i=o.tools)||void 0===i?void 0:i.map(e=>e.id))||[]})}else v({part_number:"",descrizione_breve:"",num_valvole_richieste:1,note_produzione:null,ciclo_cura_id:null,tool_ids:[]});j({})},[o,i]);let A=(e,i)=>{v(r=>({...r,[e]:i})),_[e]&&j(i=>{let r={...i};return delete r[e],r})},I=()=>{try{let e={...x,num_valvole_richieste:Number(x.num_valvole_richieste),ciclo_cura_id:null!==x.ciclo_cura_id?Number(x.ciclo_cura_id):null,tool_ids:x.tool_ids||[]};return p.parse(e),{valid:!0,errors:{}}}catch(e){if(e instanceof u.z.ZodError){let i={};return e.errors.forEach(e=>{e.path[0]&&(i[e.path[0].toString()]=e.message)}),{valid:!1,errors:i}}return{valid:!1,errors:{form:"Errore di validazione"}}}},D=async()=>{let e=I();if(!e.valid){j(e.errors);return}let i={part_number:x.part_number,descrizione_breve:x.descrizione_breve,num_valvole_richieste:Number(x.num_valvole_richieste),tool_ids:x.tool_ids};x.note_produzione&&(i.note_produzione=x.note_produzione),null!==x.ciclo_cura_id&&(i.ciclo_cura_id=Number(x.ciclo_cura_id)),b(!0);try{o?(await d.os.update(o.id,i),k({variant:"success",title:"Aggiornato",description:"Parte con ID ".concat(o.id," aggiornata con successo.")})):(await d.os.create(i),k({variant:"success",title:"Creato",description:"Nuova parte creata con successo."})),c()}catch(i){console.error("Errore durante il salvataggio:",i);let e="Si \xe8 verificato un errore durante il salvataggio.";i instanceof Error&&(e=i.message),k({variant:"destructive",title:"Errore",description:e})}finally{b(!1)}};return(0,s.jsx)(m.Vq,{open:i,onOpenChange:r,children:(0,s.jsxs)(m.cZ,{className:"sm:max-w-[600px]",children:[(0,s.jsx)(m.fK,{children:(0,s.jsx)(m.$N,{children:o?"Modifica Parte: ".concat(o.id):"Crea Nuova Parte"})}),(0,s.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,s.jsx)(h._,{htmlFor:"part_number",className:"text-right",children:"Part Number"}),(0,s.jsxs)("div",{className:"col-span-3",children:[(0,s.jsxs)("select",{id:"part_number",value:x.part_number,onChange:e=>A("part_number",e.target.value),disabled:!!o||S,className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[(0,s.jsx)("option",{value:"",children:"Seleziona Part Number"}),N.map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value))]}),_.part_number&&(0,s.jsx)("p",{className:"text-sm text-destructive mt-1",children:_.part_number})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,s.jsx)(h._,{htmlFor:"descrizione_breve",className:"text-right",children:"Descrizione"}),(0,s.jsx)(n.I,{id:"descrizione_breve",value:x.descrizione_breve,onChange:e=>A("descrizione_breve",e.target.value),className:"col-span-3"}),_.descrizione_breve&&(0,s.jsx)("p",{className:"col-span-4 text-right text-sm text-destructive",children:_.descrizione_breve})]}),(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,s.jsx)(h._,{htmlFor:"num_valvole_richieste",className:"text-right",children:"Valvole"}),(0,s.jsx)(n.I,{id:"num_valvole_richieste",type:"number",min:"1",value:x.num_valvole_richieste,onChange:e=>A("num_valvole_richieste",e.target.value?Number(e.target.value):1),className:"col-span-3"}),_.num_valvole_richieste&&(0,s.jsx)("p",{className:"col-span-4 text-right text-sm text-destructive",children:_.num_valvole_richieste})]}),(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,s.jsx)(h._,{htmlFor:"ciclo_cura_id",className:"text-right",children:"Ciclo di Cura"}),(0,s.jsx)("div",{className:"col-span-3",children:(0,s.jsxs)("select",{id:"ciclo_cura_id",value:null!==x.ciclo_cura_id?x.ciclo_cura_id:"",onChange:e=>A("ciclo_cura_id",e.target.value?Number(e.target.value):null),className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",disabled:S,children:[(0,s.jsx)("option",{value:"",children:"Nessun ciclo di cura"}),y.map(e=>(0,s.jsx)("option",{value:e.id,children:e.nome},e.id))]})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-4 items-start gap-4",children:[(0,s.jsx)(h._,{htmlFor:"tool_ids",className:"text-right pt-2",children:"Tools/Stampi"}),(0,s.jsx)("div",{className:"col-span-3",children:(0,s.jsx)("div",{className:"p-2 border rounded-md max-h-40 overflow-y-auto",children:0===z.length?(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Nessun tool disponibile"}):z.map(e=>(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,s.jsx)("input",{type:"checkbox",id:"tool-".concat(e.id),checked:x.tool_ids.includes(e.id),onChange:i=>{let r=[...x.tool_ids],s=i.target.checked?[...r,e.id]:r.filter(i=>i!==e.id);A("tool_ids",s)},disabled:S,className:"h-4 w-4 rounded border-gray-300"}),(0,s.jsxs)("label",{htmlFor:"tool-".concat(e.id),className:"text-sm",children:[e.codice," ",e.descrizione&&"- ".concat(e.descrizione)]})]},e.id))})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,s.jsx)(h._,{htmlFor:"note_produzione",className:"text-right",children:"Note Produzione"}),(0,s.jsx)("textarea",{id:"note_produzione",value:x.note_produzione||"",onChange:e=>A("note_produzione",e.target.value||null),className:"col-span-3 flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm",placeholder:"Note opzionali sulla produzione"})]})]}),(0,s.jsxs)(m.cN,{children:[(0,s.jsx)(l.z,{type:"button",variant:"outline",onClick:r,disabled:g||S,children:"Annulla"}),(0,s.jsx)(l.z,{type:"button",onClick:D,disabled:g||S,children:g?"Salvataggio...":o?"Aggiorna":"Crea"})]})]})})}var v=r(6264),_=r(7472),j=r(3905),g=r(5367),b=r(9346);function N(){let[e,i]=(0,a.useState)([]),[r,u]=(0,a.useState)(!0),[m,h]=(0,a.useState)(""),[p,N]=(0,a.useState)({}),[f,z]=(0,a.useState)(!1),[C,y]=(0,a.useState)(null),{toast:w}=(0,t.p)(),S=async()=>{try{u(!0);let e=await d.os.getAll(p);i(e)}catch(e){console.error("Errore nel caricamento delle parti:",e),w({variant:"destructive",title:"Errore",description:"Impossibile caricare le parti. Riprova pi\xf9 tardi."})}finally{u(!1)}};(0,a.useEffect)(()=>{S()},[p]);let E=e=>{y(e),z(!0)},k=async e=>{if(window.confirm("Sei sicuro di voler eliminare la parte con ID ".concat(e,"?")))try{await d.os.delete(e),w({variant:"success",title:"Eliminata",description:"Parte con ID ".concat(e," eliminata con successo.")}),S()}catch(i){console.error("Errore durante l'eliminazione della parte ".concat(e,":"),i),w({variant:"destructive",title:"Errore",description:"Impossibile eliminare la parte con ID ".concat(e,".")})}},P=e.filter(e=>{let i=m.toLowerCase();return e.part_number.toLowerCase().includes(i)||e.descrizione_breve.toLowerCase().includes(i)});return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Parti"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Gestisci le parti in produzione"})]}),(0,s.jsx)(l.z,{onClick:()=>{y(null),z(!0)},children:"Nuova Parte"})]}),(0,s.jsx)("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:(0,s.jsx)(n.I,{placeholder:"Cerca nelle parti...",value:m,onChange:e=>h(e.target.value),className:"max-w-sm"})}),r?(0,s.jsxs)("div",{className:"flex justify-center py-8",children:[(0,s.jsx)(v.Z,{className:"h-8 w-8 animate-spin"}),(0,s.jsx)("span",{className:"ml-2",children:"Caricamento in corso..."})]}):(0,s.jsxs)(c.iA,{children:[(0,s.jsx)(c.Rn,{children:"Lista delle parti in produzione"}),(0,s.jsx)(c.xD,{children:(0,s.jsxs)(c.SC,{children:[(0,s.jsx)(c.ss,{children:"ID"}),(0,s.jsx)(c.ss,{children:"Part Number"}),(0,s.jsx)(c.ss,{children:"Descrizione"}),(0,s.jsx)(c.ss,{className:"text-center",children:"Valvole"}),(0,s.jsx)(c.ss,{children:"Tools"}),(0,s.jsx)(c.ss,{className:"text-right",children:"Azioni"})]})}),(0,s.jsx)(c.RM,{children:0===P.length?(0,s.jsx)(c.SC,{children:(0,s.jsx)(c.pj,{colSpan:6,className:"text-center py-8",children:"Nessuna parte trovata"})}):P.map(e=>(0,s.jsxs)(c.SC,{children:[(0,s.jsx)(c.pj,{className:"font-medium",children:e.id}),(0,s.jsx)(c.pj,{children:e.part_number}),(0,s.jsx)(c.pj,{className:"max-w-xs truncate",children:e.descrizione_breve}),(0,s.jsx)(c.pj,{className:"text-center",children:e.num_valvole_richieste}),(0,s.jsx)(c.pj,{children:e.tools.length>0?(0,s.jsx)("div",{className:"flex flex-wrap gap-1",children:e.tools.map(e=>(0,s.jsx)(o.C,{variant:"secondary",className:"mr-1",children:e.codice},e.id))}):"-"}),(0,s.jsx)(c.pj,{className:"text-right",children:(0,s.jsxs)(b.h_,{children:[(0,s.jsx)(b.$F,{asChild:!0,children:(0,s.jsx)(l.z,{variant:"ghost",size:"icon",children:(0,s.jsx)(_.Z,{className:"h-4 w-4"})})}),(0,s.jsxs)(b.AW,{align:"end",children:[(0,s.jsxs)(b.Xi,{onClick:()=>E(e),children:[(0,s.jsx)(j.Z,{className:"mr-2 h-4 w-4"}),(0,s.jsx)("span",{children:"Modifica"})]}),(0,s.jsxs)(b.Xi,{onClick:()=>k(e.id),className:"text-destructive focus:text-destructive",children:[(0,s.jsx)(g.Z,{className:"mr-2 h-4 w-4"}),(0,s.jsx)("span",{children:"Elimina"})]})]})]})})]},e.id))})]}),(0,s.jsx)(x,{isOpen:f,onClose:()=>z(!1),item:C,onSuccess:()=>{S(),z(!1)}})]})}}},function(e){e.O(0,[310,621,709,936,537,578,934,971,472,744],function(){return e(e.s=5318)}),_N_E=e.O()}]);