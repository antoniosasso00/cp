(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[234],{5318:function(e,i,r){Promise.resolve().then(r.bind(r,5029))},5029:function(e,i,r){"use strict";r.r(i),r.d(i,{default:function(){return _}});var t=r(7437),a=r(2265),l=r(4622),s=r(3089),n=r(6582),c=r(5271),o=r(150),d=r(6454),u=r(4578),m=r(1472),p=r(6429);let h=u.z.object({part_number:u.z.string().min(1,"Part Number obbligatorio"),descrizione_breve:u.z.string().min(1,"Descrizione obbligatoria"),num_valvole_richieste:u.z.number().min(1,"Almeno una valvola richiesta"),note_produzione:u.z.string().optional().nullable(),ciclo_cura_id:u.z.number().optional().nullable(),tool_ids:u.z.array(u.z.number()).optional().default([])});function v(e){let{isOpen:i,onClose:r,onSuccess:c,item:o}=e,[v,_]=(0,a.useState)({part_number:"",descrizione_breve:"",num_valvole_richieste:1,note_produzione:null,ciclo_cura_id:null,tool_ids:[]}),[x,g]=(0,a.useState)({}),[b,j]=(0,a.useState)(!1),[N,z]=(0,a.useState)([]),[f,y]=(0,a.useState)([]),[C,w]=(0,a.useState)([]),[S,E]=(0,a.useState)(!1),{toast:k}=(0,l.p)(),P=async()=>{E(!0);try{let[e,i,r]=await Promise.all([d.NN.getAll({attivo:!0}),d.UK.getAll(),d.iE.getAll()]);z(e.map(e=>({value:e.part_number,label:"".concat(e.part_number," - ").concat(e.descrizione),categoria:e.categoria}))),y(i),w(r)}catch(e){console.error("Errore nel caricamento delle opzioni:",e),k({variant:"destructive",title:"Errore",description:"Impossibile caricare le opzioni. Riprova pi\xf9 tardi."})}finally{E(!1)}};(0,a.useEffect)(()=>{i&&P()},[i]),(0,a.useEffect)(()=>{if(o){var e,i;_({part_number:o.part_number,descrizione_breve:o.descrizione_breve,num_valvole_richieste:o.num_valvole_richieste,note_produzione:o.note_produzione||null,ciclo_cura_id:(null===(e=o.ciclo_cura)||void 0===e?void 0:e.id)||null,tool_ids:(null===(i=o.tools)||void 0===i?void 0:i.map(e=>e.id))||[]})}else _({part_number:"",descrizione_breve:"",num_valvole_richieste:1,note_produzione:null,ciclo_cura_id:null,tool_ids:[]});g({})},[o,i]);let I=(e,i)=>{_(r=>({...r,[e]:i})),x[e]&&g(i=>{let r={...i};return delete r[e],r})},A=()=>{try{let e={...v,num_valvole_richieste:Number(v.num_valvole_richieste),ciclo_cura_id:null!==v.ciclo_cura_id?Number(v.ciclo_cura_id):null,tool_ids:v.tool_ids||[]};return h.parse(e),{valid:!0,errors:{}}}catch(e){if(e instanceof u.z.ZodError){let i={};return e.errors.forEach(e=>{e.path[0]&&(i[e.path[0].toString()]=e.message)}),{valid:!1,errors:i}}return{valid:!1,errors:{form:"Errore di validazione"}}}},D=async()=>{let e=A();if(!e.valid){g(e.errors);return}let i={part_number:v.part_number,descrizione_breve:v.descrizione_breve,num_valvole_richieste:Number(v.num_valvole_richieste),tool_ids:v.tool_ids};v.note_produzione&&(i.note_produzione=v.note_produzione),null!==v.ciclo_cura_id&&(i.ciclo_cura_id=Number(v.ciclo_cura_id)),j(!0);try{o?(await d.os.update(o.id,i),k({variant:"success",title:"Aggiornato",description:"Parte con ID ".concat(o.id," aggiornata con successo.")})):(await d.os.create(i),k({variant:"success",title:"Creato",description:"Nuova parte creata con successo."})),c()}catch(i){console.error("Errore durante il salvataggio:",i);let e="Si \xe8 verificato un errore durante il salvataggio.";i instanceof Error&&(e=i.message),k({variant:"destructive",title:"Errore",description:e})}finally{j(!1)}};return(0,t.jsx)(m.Vq,{open:i,onOpenChange:r,children:(0,t.jsxs)(m.cZ,{className:"sm:max-w-[600px]",children:[(0,t.jsx)(m.fK,{children:(0,t.jsx)(m.$N,{children:o?"Modifica Parte: ".concat(o.id):"Crea Nuova Parte"})}),(0,t.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,t.jsx)(p._,{htmlFor:"part_number",className:"text-right",children:"Part Number"}),(0,t.jsxs)("div",{className:"col-span-3",children:[(0,t.jsxs)("select",{id:"part_number",value:v.part_number,onChange:e=>I("part_number",e.target.value),disabled:!!o||S,className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[(0,t.jsx)("option",{value:"",children:"Seleziona Part Number"}),N.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))]}),x.part_number&&(0,t.jsx)("p",{className:"text-sm text-destructive mt-1",children:x.part_number})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,t.jsx)(p._,{htmlFor:"descrizione_breve",className:"text-right",children:"Descrizione"}),(0,t.jsx)(n.I,{id:"descrizione_breve",value:v.descrizione_breve,onChange:e=>I("descrizione_breve",e.target.value),className:"col-span-3"}),x.descrizione_breve&&(0,t.jsx)("p",{className:"col-span-4 text-right text-sm text-destructive",children:x.descrizione_breve})]}),(0,t.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,t.jsx)(p._,{htmlFor:"num_valvole_richieste",className:"text-right",children:"Valvole"}),(0,t.jsx)(n.I,{id:"num_valvole_richieste",type:"number",min:"1",value:v.num_valvole_richieste,onChange:e=>I("num_valvole_richieste",e.target.value?Number(e.target.value):1),className:"col-span-3"}),x.num_valvole_richieste&&(0,t.jsx)("p",{className:"col-span-4 text-right text-sm text-destructive",children:x.num_valvole_richieste})]}),(0,t.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,t.jsx)(p._,{htmlFor:"ciclo_cura_id",className:"text-right",children:"Ciclo di Cura"}),(0,t.jsx)("div",{className:"col-span-3",children:(0,t.jsxs)("select",{id:"ciclo_cura_id",value:null!==v.ciclo_cura_id?v.ciclo_cura_id:"",onChange:e=>I("ciclo_cura_id",e.target.value?Number(e.target.value):null),className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",disabled:S,children:[(0,t.jsx)("option",{value:"",children:"Nessun ciclo di cura"}),C.map(e=>(0,t.jsx)("option",{value:e.id,children:e.nome},e.id))]})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-4 items-start gap-4",children:[(0,t.jsx)(p._,{htmlFor:"tool_ids",className:"text-right pt-2",children:"Tools/Stampi"}),(0,t.jsx)("div",{className:"col-span-3",children:(0,t.jsx)("div",{className:"p-2 border rounded-md max-h-40 overflow-y-auto",children:0===f.length?(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Nessun tool disponibile"}):f.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)("input",{type:"checkbox",id:"tool-".concat(e.id),checked:v.tool_ids.includes(e.id),onChange:i=>{let r=[...v.tool_ids],t=i.target.checked?[...r,e.id]:r.filter(i=>i!==e.id);I("tool_ids",t)},disabled:S,className:"h-4 w-4 rounded border-gray-300"}),(0,t.jsxs)("label",{htmlFor:"tool-".concat(e.id),className:"text-sm",children:[e.codice," ",e.descrizione&&"- ".concat(e.descrizione)]})]},e.id))})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,t.jsx)(p._,{htmlFor:"note_produzione",className:"text-right",children:"Note Produzione"}),(0,t.jsx)("textarea",{id:"note_produzione",value:v.note_produzione||"",onChange:e=>I("note_produzione",e.target.value||null),className:"col-span-3 flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm",placeholder:"Note opzionali sulla produzione"})]})]}),(0,t.jsxs)(m.cN,{children:[(0,t.jsx)(s.z,{type:"button",variant:"outline",onClick:r,disabled:b||S,children:"Annulla"}),(0,t.jsx)(s.z,{type:"button",onClick:D,disabled:b||S,children:b?"Salvataggio...":o?"Aggiorna":"Crea"})]})]})})}function _(){let[e,i]=(0,a.useState)([]),[r,u]=(0,a.useState)(!0),[m,p]=(0,a.useState)(""),[h,_]=(0,a.useState)({}),[x,g]=(0,a.useState)(!1),[b,j]=(0,a.useState)(null),{toast:N}=(0,l.p)(),z=async()=>{try{u(!0);let e=await d.os.getAll(h);i(e)}catch(e){console.error("Errore nel caricamento delle parti:",e),N({variant:"destructive",title:"Errore",description:"Impossibile caricare le parti. Riprova pi\xf9 tardi."})}finally{u(!1)}};(0,a.useEffect)(()=>{z()},[h]);let f=e=>{j(e),g(!0)},y=async e=>{if(window.confirm("Sei sicuro di voler eliminare la parte con ID ".concat(e,"?")))try{await d.os.delete(e),N({variant:"success",title:"Eliminata",description:"Parte con ID ".concat(e," eliminata con successo.")}),z()}catch(i){console.error("Errore durante l'eliminazione della parte ".concat(e,":"),i),N({variant:"destructive",title:"Errore",description:"Impossibile eliminare la parte con ID ".concat(e,".")})}},C=e.filter(e=>{let i=m.toLowerCase();return e.part_number.toLowerCase().includes(i)||e.descrizione_breve.toLowerCase().includes(i)});return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Parti"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Gestisci le parti in produzione"})]}),(0,t.jsx)(s.z,{onClick:()=>{j(null),g(!0)},children:"Nuova Parte"})]}),(0,t.jsx)("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:(0,t.jsx)(n.I,{placeholder:"Cerca nelle parti...",value:m,onChange:e=>p(e.target.value),className:"max-w-sm"})}),r?(0,t.jsx)("div",{className:"flex justify-center py-8",children:(0,t.jsx)("p",{children:"Caricamento in corso..."})}):(0,t.jsxs)(c.iA,{children:[(0,t.jsx)(c.Rn,{children:"Lista delle parti in produzione"}),(0,t.jsx)(c.xD,{children:(0,t.jsxs)(c.SC,{children:[(0,t.jsx)(c.ss,{children:"ID"}),(0,t.jsx)(c.ss,{children:"Part Number"}),(0,t.jsx)(c.ss,{children:"Descrizione"}),(0,t.jsx)(c.ss,{className:"text-center",children:"Valvole"}),(0,t.jsx)(c.ss,{children:"Tools"}),(0,t.jsx)(c.ss,{className:"text-right",children:"Azioni"})]})}),(0,t.jsx)(c.RM,{children:0===C.length?(0,t.jsx)(c.SC,{children:(0,t.jsx)(c.pj,{colSpan:6,className:"text-center py-8",children:"Nessuna parte trovata"})}):C.map(e=>(0,t.jsxs)(c.SC,{children:[(0,t.jsx)(c.pj,{className:"font-medium",children:e.id}),(0,t.jsx)(c.pj,{children:e.part_number}),(0,t.jsx)(c.pj,{className:"max-w-xs truncate",children:e.descrizione_breve}),(0,t.jsx)(c.pj,{className:"text-center",children:e.num_valvole_richieste}),(0,t.jsx)(c.pj,{children:e.tools.length>0?(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:e.tools.map(e=>(0,t.jsx)(o.C,{variant:"secondary",className:"mr-1",children:e.codice},e.id))}):"-"}),(0,t.jsx)(c.pj,{className:"text-right",children:(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsx)(s.z,{variant:"outline",size:"sm",onClick:()=>f(e),children:"Modifica"}),(0,t.jsx)(s.z,{variant:"destructive",size:"sm",onClick:()=>y(e.id),children:"Elimina"})]})})]},e.id))})]}),(0,t.jsx)(v,{isOpen:x,onClose:()=>g(!1),item:b,onSuccess:()=>{z(),g(!1)}})]})}}},function(e){e.O(0,[310,710,408,578,662,971,472,744],function(){return e(e.s=5318)}),_N_E=e.O()}]);