(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[151],{1979:function(e,t,a){Promise.resolve().then(a.bind(a,705))},705:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return z}});var r=a(7437),i=a(2265),s=a(4622),n=a(3089),c=a(6582),o=a(5271),l=a(150),d=a(6454),u=a(345),m=a(4578),x=a(1472),h=a(6429);let p=m.z.object({part_number:m.z.string().min(1,"Part Number obbligatorio").max(50,"Massimo 50 caratteri"),descrizione:m.z.string().min(1,"Descrizione obbligatoria"),categoria:m.z.string().optional(),attivo:m.z.boolean(),note:m.z.string().optional()});function g(e){let{isOpen:t,onClose:a,onSuccess:o,item:l}=e,[u,g]=(0,i.useState)({part_number:"",descrizione:"",categoria:"",attivo:!0,note:""}),[v,j]=(0,i.useState)({}),[N,b]=(0,i.useState)(!1),{toast:f}=(0,s.p)();(0,i.useEffect)(()=>{l?g({part_number:l.part_number,descrizione:l.descrizione,categoria:l.categoria||"",attivo:l.attivo,note:l.note||""}):g({part_number:"",descrizione:"",categoria:"",attivo:!0,note:""}),j({})},[l,t]);let z=(e,t)=>{g(a=>({...a,[e]:t})),v[e]&&j(t=>{let a={...t};return delete a[e],a})},C=()=>{try{return p.parse(u),{valid:!0,errors:{}}}catch(e){if(e instanceof m.z.ZodError){let t={};return e.errors.forEach(e=>{e.path[0]&&(t[e.path[0].toString()]=e.message)}),{valid:!1,errors:t}}return{valid:!1,errors:{form:"Errore di validazione"}}}},_=async()=>{let e=C();if(!e.valid){j(e.errors);return}b(!0);try{if(l){let e={descrizione:u.descrizione,categoria:u.categoria||void 0,attivo:u.attivo,note:u.note||void 0};await d.NN.update(l.part_number,e),f({variant:"success",title:"Aggiornato",description:"Part number ".concat(l.part_number," aggiornato con successo.")})}else await d.NN.create(u),f({variant:"success",title:"Creato",description:"Nuovo part number ".concat(u.part_number," creato con successo.")});o()}catch(t){console.error("Errore durante il salvataggio:",t);let e="Si \xe8 verificato un errore durante il salvataggio.";t instanceof Error&&(e=t.message),f({variant:"destructive",title:"Errore",description:e})}finally{b(!1)}};return(0,r.jsx)(x.Vq,{open:t,onOpenChange:a,children:(0,r.jsxs)(x.cZ,{className:"sm:max-w-[500px]",children:[(0,r.jsx)(x.fK,{children:(0,r.jsx)(x.$N,{children:l?"Modifica Part Number: ".concat(l.part_number):"Crea Nuovo Part Number"})}),(0,r.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,r.jsx)(h._,{htmlFor:"part_number",className:"text-right",children:"Part Number"}),(0,r.jsx)(c.I,{id:"part_number",value:u.part_number||"",onChange:e=>z("part_number",e.target.value),disabled:!!l,className:"col-span-3"}),v.part_number&&(0,r.jsx)("p",{className:"col-span-4 text-right text-sm text-destructive",children:v.part_number})]}),(0,r.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,r.jsx)(h._,{htmlFor:"descrizione",className:"text-right",children:"Descrizione"}),(0,r.jsx)(c.I,{id:"descrizione",value:u.descrizione||"",onChange:e=>z("descrizione",e.target.value),className:"col-span-3"}),v.descrizione&&(0,r.jsx)("p",{className:"col-span-4 text-right text-sm text-destructive",children:v.descrizione})]}),(0,r.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,r.jsx)(h._,{htmlFor:"categoria",className:"text-right",children:"Categoria"}),(0,r.jsx)(c.I,{id:"categoria",value:u.categoria||"",onChange:e=>z("categoria",e.target.value),className:"col-span-3",placeholder:"Opzionale"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,r.jsx)(h._,{htmlFor:"note",className:"text-right",children:"Note"}),(0,r.jsx)(c.I,{id:"note",value:u.note||"",onChange:e=>z("note",e.target.value),className:"col-span-3",placeholder:"Opzionale"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,r.jsx)(h._,{htmlFor:"attivo",className:"text-right",children:"Stato"}),(0,r.jsx)("div",{className:"col-span-3",children:(0,r.jsxs)("select",{id:"attivo",value:u.attivo?"true":"false",onChange:e=>z("attivo","true"===e.target.value),className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[(0,r.jsx)("option",{value:"true",children:"Attivo"}),(0,r.jsx)("option",{value:"false",children:"Non attivo"})]})})]})]}),(0,r.jsxs)(x.cN,{children:[(0,r.jsx)(n.z,{type:"button",variant:"outline",onClick:a,disabled:N,children:"Annulla"}),(0,r.jsx)(n.z,{type:"button",onClick:_,disabled:N,children:N?"Salvataggio...":l?"Aggiorna":"Crea"})]})]})})}var v=a(6264),j=a(7472),N=a(3905),b=a(5367),f=a(9346);function z(){let[e,t]=(0,i.useState)([]),[a,m]=(0,i.useState)(!0),[x,h]=(0,i.useState)(""),[p,z]=(0,i.useState)({}),[C,_]=(0,i.useState)(!1),[w,y]=(0,i.useState)(null),{toast:S}=(0,s.p)(),E=async()=>{try{m(!0);let e=await d.NN.getAll(p);t(e)}catch(e){console.error("Errore nel caricamento del catalogo:",e),S({variant:"destructive",title:"Errore",description:"Impossibile caricare il catalogo. Riprova pi\xf9 tardi."})}finally{m(!1)}};(0,i.useEffect)(()=>{E()},[p]);let k=e=>{y(e),_(!0)},A=async e=>{if(window.confirm("Sei sicuro di voler eliminare ".concat(e,"?")))try{await d.NN.delete(e),S({variant:"success",title:"Eliminato",description:"Part number ".concat(e," eliminato con successo.")}),E()}catch(t){console.error("Errore durante l'eliminazione di ".concat(e,":"),t),S({variant:"destructive",title:"Errore",description:"Impossibile eliminare ".concat(e,". Potrebbe essere utilizzato in altre parti.")})}},P=e.filter(e=>{let t=x.toLowerCase();return e.part_number.toLowerCase().includes(t)||e.descrizione.toLowerCase().includes(t)||e.categoria&&e.categoria.toLowerCase().includes(t)}),I=Array.from(new Set(e.map(e=>e.categoria).filter(Boolean)));return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Catalogo"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"Gestisci i part number disponibili nel catalogo"})]}),(0,r.jsx)(n.z,{onClick:()=>{y(null),_(!0)},children:"Nuovo Part Number"})]}),(0,r.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:[(0,r.jsx)(c.I,{placeholder:"Cerca nel catalogo...",value:x,onChange:e=>h(e.target.value),className:"max-w-sm"}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,r.jsxs)("select",{className:"px-3 py-2 rounded-md border text-sm",value:p.categoria||"",onChange:e=>z({...p,categoria:e.target.value||void 0}),children:[(0,r.jsx)("option",{value:"",children:"Tutte le categorie"}),I.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]}),(0,r.jsxs)("select",{className:"px-3 py-2 rounded-md border text-sm",value:void 0===p.attivo?"":p.attivo?"true":"false",onChange:e=>{let t=e.target.value;z({...p,attivo:""===t?void 0:"true"===t})},children:[(0,r.jsx)("option",{value:"",children:"Tutti gli stati"}),(0,r.jsx)("option",{value:"true",children:"Attivi"}),(0,r.jsx)("option",{value:"false",children:"Non attivi"})]})]})]}),a?(0,r.jsxs)("div",{className:"flex justify-center py-8",children:[(0,r.jsx)(v.Z,{className:"h-8 w-8 animate-spin"}),(0,r.jsx)("span",{className:"ml-2",children:"Caricamento in corso..."})]}):(0,r.jsxs)(o.iA,{children:[(0,r.jsx)(o.Rn,{children:"Lista dei part number nel catalogo"}),(0,r.jsx)(o.xD,{children:(0,r.jsxs)(o.SC,{children:[(0,r.jsx)(o.ss,{children:"Part Number"}),(0,r.jsx)(o.ss,{children:"Descrizione"}),(0,r.jsx)(o.ss,{children:"Categoria"}),(0,r.jsx)(o.ss,{className:"text-center",children:"Stato"}),(0,r.jsx)(o.ss,{children:"Ultima modifica"}),(0,r.jsx)(o.ss,{className:"text-right",children:"Azioni"})]})}),(0,r.jsx)(o.RM,{children:0===P.length?(0,r.jsx)(o.SC,{children:(0,r.jsx)(o.pj,{colSpan:6,className:"text-center py-8",children:"Nessun part number trovato"})}):P.map(e=>(0,r.jsxs)(o.SC,{children:[(0,r.jsx)(o.pj,{className:"font-medium",children:e.part_number}),(0,r.jsx)(o.pj,{className:"max-w-xs truncate",children:e.descrizione}),(0,r.jsx)(o.pj,{children:e.categoria||"-"}),(0,r.jsx)(o.pj,{className:"text-center",children:(0,r.jsx)(l.C,{variant:e.attivo?"success":"outline",children:e.attivo?"Attivo":"Non attivo"})}),(0,r.jsx)(o.pj,{children:(0,u.Q)(e.updated_at)}),(0,r.jsx)(o.pj,{className:"text-right",children:(0,r.jsxs)(f.h_,{children:[(0,r.jsx)(f.$F,{asChild:!0,children:(0,r.jsx)(n.z,{variant:"ghost",size:"icon",children:(0,r.jsx)(j.Z,{className:"h-4 w-4"})})}),(0,r.jsxs)(f.AW,{align:"end",children:[(0,r.jsxs)(f.Xi,{onClick:()=>k(e),children:[(0,r.jsx)(N.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Modifica"})]}),(0,r.jsxs)(f.Xi,{onClick:()=>A(e.part_number),className:"text-destructive focus:text-destructive",children:[(0,r.jsx)(b.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Elimina"})]})]})]})})]},e.part_number))})]}),(0,r.jsx)(g,{isOpen:C,onClose:()=>_(!1),item:w,onSuccess:()=>{E(),_(!1)}})]})}}},function(e){e.O(0,[310,621,709,936,537,578,934,971,472,744],function(){return e(e.s=1979)}),_N_E=e.O()}]);