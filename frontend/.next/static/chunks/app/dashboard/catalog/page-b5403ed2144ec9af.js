(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[151],{1979:function(e,t,a){Promise.resolve().then(a.bind(a,705))},705:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return v}});var r=a(7437),i=a(2265),s=a(4622),n=a(3089),o=a(6582),c=a(5271),l=a(150),d=a(6454),u=a(345),m=a(4578),x=a(1472),p=a(6429);let h=m.z.object({part_number:m.z.string().min(1,"Part Number obbligatorio").max(50,"Massimo 50 caratteri"),descrizione:m.z.string().min(1,"Descrizione obbligatoria"),categoria:m.z.string().optional(),attivo:m.z.boolean(),note:m.z.string().optional()});function g(e){let{isOpen:t,onClose:a,onSuccess:c,item:l}=e,[u,g]=(0,i.useState)({part_number:"",descrizione:"",categoria:"",attivo:!0,note:""}),[v,j]=(0,i.useState)({}),[N,b]=(0,i.useState)(!1),{toast:f}=(0,s.p)();(0,i.useEffect)(()=>{l?g({part_number:l.part_number,descrizione:l.descrizione,categoria:l.categoria||"",attivo:l.attivo,note:l.note||""}):g({part_number:"",descrizione:"",categoria:"",attivo:!0,note:""}),j({})},[l,t]);let z=(e,t)=>{g(a=>({...a,[e]:t})),v[e]&&j(t=>{let a={...t};return delete a[e],a})},C=()=>{try{return h.parse(u),{valid:!0,errors:{}}}catch(e){if(e instanceof m.z.ZodError){let t={};return e.errors.forEach(e=>{e.path[0]&&(t[e.path[0].toString()]=e.message)}),{valid:!1,errors:t}}return{valid:!1,errors:{form:"Errore di validazione"}}}},_=async()=>{let e=C();if(!e.valid){j(e.errors);return}b(!0);try{if(l){let e={descrizione:u.descrizione,categoria:u.categoria||void 0,attivo:u.attivo,note:u.note||void 0};await d.NN.update(l.part_number,e),f({variant:"success",title:"Aggiornato",description:"Part number ".concat(l.part_number," aggiornato con successo.")})}else await d.NN.create(u),f({variant:"success",title:"Creato",description:"Nuovo part number ".concat(u.part_number," creato con successo.")});c()}catch(t){console.error("Errore durante il salvataggio:",t);let e="Si \xe8 verificato un errore durante il salvataggio.";t instanceof Error&&(e=t.message),f({variant:"destructive",title:"Errore",description:e})}finally{b(!1)}};return(0,r.jsx)(x.Vq,{open:t,onOpenChange:a,children:(0,r.jsxs)(x.cZ,{className:"sm:max-w-[500px]",children:[(0,r.jsx)(x.fK,{children:(0,r.jsx)(x.$N,{children:l?"Modifica Part Number: ".concat(l.part_number):"Crea Nuovo Part Number"})}),(0,r.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,r.jsx)(p._,{htmlFor:"part_number",className:"text-right",children:"Part Number"}),(0,r.jsx)(o.I,{id:"part_number",value:u.part_number||"",onChange:e=>z("part_number",e.target.value),disabled:!!l,className:"col-span-3"}),v.part_number&&(0,r.jsx)("p",{className:"col-span-4 text-right text-sm text-destructive",children:v.part_number})]}),(0,r.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,r.jsx)(p._,{htmlFor:"descrizione",className:"text-right",children:"Descrizione"}),(0,r.jsx)(o.I,{id:"descrizione",value:u.descrizione||"",onChange:e=>z("descrizione",e.target.value),className:"col-span-3"}),v.descrizione&&(0,r.jsx)("p",{className:"col-span-4 text-right text-sm text-destructive",children:v.descrizione})]}),(0,r.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,r.jsx)(p._,{htmlFor:"categoria",className:"text-right",children:"Categoria"}),(0,r.jsx)(o.I,{id:"categoria",value:u.categoria||"",onChange:e=>z("categoria",e.target.value),className:"col-span-3",placeholder:"Opzionale"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,r.jsx)(p._,{htmlFor:"note",className:"text-right",children:"Note"}),(0,r.jsx)(o.I,{id:"note",value:u.note||"",onChange:e=>z("note",e.target.value),className:"col-span-3",placeholder:"Opzionale"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,r.jsx)(p._,{htmlFor:"attivo",className:"text-right",children:"Stato"}),(0,r.jsx)("div",{className:"col-span-3",children:(0,r.jsxs)("select",{id:"attivo",value:u.attivo?"true":"false",onChange:e=>z("attivo","true"===e.target.value),className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[(0,r.jsx)("option",{value:"true",children:"Attivo"}),(0,r.jsx)("option",{value:"false",children:"Non attivo"})]})})]})]}),(0,r.jsxs)(x.cN,{children:[(0,r.jsx)(n.z,{type:"button",variant:"outline",onClick:a,disabled:N,children:"Annulla"}),(0,r.jsx)(n.z,{type:"button",onClick:_,disabled:N,children:N?"Salvataggio...":l?"Aggiorna":"Crea"})]})]})})}function v(){let[e,t]=(0,i.useState)([]),[a,m]=(0,i.useState)(!0),[x,p]=(0,i.useState)(""),[h,v]=(0,i.useState)({}),[j,N]=(0,i.useState)(!1),[b,f]=(0,i.useState)(null),{toast:z}=(0,s.p)(),C=async()=>{try{m(!0);let e=await d.NN.getAll(h);t(e)}catch(e){console.error("Errore nel caricamento del catalogo:",e),z({variant:"destructive",title:"Errore",description:"Impossibile caricare il catalogo. Riprova pi\xf9 tardi."})}finally{m(!1)}};(0,i.useEffect)(()=>{C()},[h]);let _=e=>{f(e),N(!0)},y=async e=>{if(window.confirm("Sei sicuro di voler eliminare ".concat(e,"?")))try{await d.NN.delete(e),z({variant:"success",title:"Eliminato",description:"Part number ".concat(e," eliminato con successo.")}),C()}catch(t){console.error("Errore durante l'eliminazione di ".concat(e,":"),t),z({variant:"destructive",title:"Errore",description:"Impossibile eliminare ".concat(e,". Potrebbe essere utilizzato in altre parti.")})}},w=e.filter(e=>{let t=x.toLowerCase();return e.part_number.toLowerCase().includes(t)||e.descrizione.toLowerCase().includes(t)||e.categoria&&e.categoria.toLowerCase().includes(t)}),S=Array.from(new Set(e.map(e=>e.categoria).filter(Boolean)));return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Catalogo"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"Gestisci i part number disponibili nel catalogo"})]}),(0,r.jsx)(n.z,{onClick:()=>{f(null),N(!0)},children:"Nuovo Part Number"})]}),(0,r.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:[(0,r.jsx)(o.I,{placeholder:"Cerca nel catalogo...",value:x,onChange:e=>p(e.target.value),className:"max-w-sm"}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,r.jsxs)("select",{className:"px-3 py-2 rounded-md border text-sm",value:h.categoria||"",onChange:e=>v({...h,categoria:e.target.value||void 0}),children:[(0,r.jsx)("option",{value:"",children:"Tutte le categorie"}),S.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]}),(0,r.jsxs)("select",{className:"px-3 py-2 rounded-md border text-sm",value:void 0===h.attivo?"":h.attivo?"true":"false",onChange:e=>{let t=e.target.value;v({...h,attivo:""===t?void 0:"true"===t})},children:[(0,r.jsx)("option",{value:"",children:"Tutti gli stati"}),(0,r.jsx)("option",{value:"true",children:"Attivi"}),(0,r.jsx)("option",{value:"false",children:"Non attivi"})]})]})]}),a?(0,r.jsx)("div",{className:"flex justify-center py-8",children:(0,r.jsx)("p",{children:"Caricamento in corso..."})}):(0,r.jsxs)(c.iA,{children:[(0,r.jsx)(c.Rn,{children:"Lista dei part number nel catalogo"}),(0,r.jsx)(c.xD,{children:(0,r.jsxs)(c.SC,{children:[(0,r.jsx)(c.ss,{children:"Part Number"}),(0,r.jsx)(c.ss,{children:"Descrizione"}),(0,r.jsx)(c.ss,{children:"Categoria"}),(0,r.jsx)(c.ss,{className:"text-center",children:"Stato"}),(0,r.jsx)(c.ss,{children:"Ultima modifica"}),(0,r.jsx)(c.ss,{className:"text-right",children:"Azioni"})]})}),(0,r.jsx)(c.RM,{children:0===w.length?(0,r.jsx)(c.SC,{children:(0,r.jsx)(c.pj,{colSpan:6,className:"text-center py-8",children:"Nessun part number trovato"})}):w.map(e=>(0,r.jsxs)(c.SC,{children:[(0,r.jsx)(c.pj,{className:"font-medium",children:e.part_number}),(0,r.jsx)(c.pj,{className:"max-w-xs truncate",children:e.descrizione}),(0,r.jsx)(c.pj,{children:e.categoria||"-"}),(0,r.jsx)(c.pj,{className:"text-center",children:(0,r.jsx)(l.C,{variant:e.attivo?"success":"outline",children:e.attivo?"Attivo":"Non attivo"})}),(0,r.jsx)(c.pj,{children:(0,u.Q)(e.updated_at)}),(0,r.jsx)(c.pj,{className:"text-right",children:(0,r.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,r.jsx)(n.z,{variant:"outline",size:"sm",onClick:()=>_(e),children:"Modifica"}),(0,r.jsx)(n.z,{variant:"destructive",size:"sm",onClick:()=>y(e.part_number),children:"Elimina"})]})})]},e.part_number))})]}),(0,r.jsx)(g,{isOpen:j,onClose:()=>N(!1),item:b,onSuccess:()=>{C(),N(!1)}})]})}}},function(e){e.O(0,[310,710,408,578,662,971,472,744],function(){return e(e.s=1979)}),_N_E=e.O()}]);