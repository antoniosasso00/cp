(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[253],{6910:function(e,i,r){Promise.resolve().then(r.bind(r,5183))},5183:function(e,i,r){"use strict";r.r(i),r.d(i,{default:function(){return y}});var t=r(7437),a=r(2265),s=r(4622),n=r(3089),l=r(6582),o=r(5271),c=r(150),d=r(6454),u=r(1472),p=r(1735),m=r(6429),h={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let x=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),f=(e,i)=>{let r=(0,a.forwardRef)(({color:r="currentColor",size:t=24,strokeWidth:s=2,absoluteStrokeWidth:n,className:l="",children:o,...c},d)=>(0,a.createElement)("svg",{ref:d,...h,width:t,height:t,stroke:r,strokeWidth:n?24*Number(s)/Number(t):s,className:["lucide",`lucide-${x(e)}`,l].join(" "),...c},[...i.map(([e,i])=>(0,a.createElement)(e,i)),...Array.isArray(o)?o:[o]]));return r.displayName=`${e}`,r},j=f("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);var v=r(345);let g=a.forwardRef((e,i)=>{let{className:r,...a}=e;return(0,t.jsx)("textarea",{className:(0,v.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:i,...a})});g.displayName="Textarea";var N=e=>{var i,r;let{isOpen:o,onClose:c,item:h,onSuccess:x}=e,{toast:f}=(0,s.p)(),[v,N]=(0,a.useState)([]),[w,b]=(0,a.useState)([]),[y,z]=(0,a.useState)(!1),[C,_]=(0,a.useState)(!1),[S,L]=(0,a.useState)({parte_id:0,tool_id:0,priorita:1,status:"Preparazione",note:""});(0,a.useEffect)(()=>{o&&(k(),h?L({parte_id:h.parte_id,tool_id:h.tool_id,priorita:h.priorita,status:h.status,note:h.note||""}):L({parte_id:0,tool_id:0,priorita:1,status:"Preparazione",note:""}))},[o,h]);let k=async()=>{try{z(!0);let[e,i]=await Promise.all([d.UK.getAll(),d.os.getAll()]);N(e),b(i)}catch(e){console.error("Errore nel caricamento delle dipendenze:",e),f({variant:"destructive",title:"Errore",description:"Impossibile caricare i dati necessari. Riprova pi\xf9 tardi."})}finally{z(!1)}},D=(e,i)=>{L(r=>({...r,[e]:i}))},O=async()=>{if(!S.parte_id||!S.tool_id){f({variant:"destructive",title:"Validazione fallita",description:"Seleziona una parte e un tool validi."});return}try{_(!0),h?(await d.LD.update(h.id,S),f({variant:"success",title:"ODL aggiornato",description:"ODL #".concat(h.id," aggiornato con successo.")})):(await d.LD.create(S),f({variant:"success",title:"ODL creato",description:"Nuovo ODL creato con successo."})),x()}catch(e){console.error("Errore nel salvataggio dell'ODL:",e),f({variant:"destructive",title:"Errore",description:"Impossibile salvare l'ODL. Verifica i dati e riprova."})}finally{_(!1)}};return(0,t.jsx)(u.Vq,{open:o,onOpenChange:c,children:(0,t.jsxs)(u.cZ,{className:"sm:max-w-[500px]",children:[(0,t.jsxs)(u.fK,{children:[(0,t.jsx)(u.$N,{children:h?"Modifica ODL #".concat(h.id):"Crea nuovo ODL"}),(0,t.jsx)(u.Be,{children:h?"Modifica i dettagli dell'ordine di lavoro":"Inserisci i dettagli per creare un nuovo ordine di lavoro"})]}),y?(0,t.jsxs)("div",{className:"flex justify-center items-center py-8",children:[(0,t.jsx)(j,{className:"h-8 w-8 animate-spin"}),(0,t.jsx)("span",{className:"ml-2",children:"Caricamento in corso..."})]}):(0,t.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,t.jsx)(m._,{htmlFor:"parte_id",className:"text-right",children:"Parte"}),(0,t.jsx)("div",{className:"col-span-3",children:(0,t.jsxs)(p.Ph,{value:(null===(i=S.parte_id)||void 0===i?void 0:i.toString())||"",onValueChange:e=>D("parte_id",parseInt(e)),children:[(0,t.jsx)(p.i4,{children:(0,t.jsx)(p.ki,{placeholder:"Seleziona una parte"})}),(0,t.jsx)(p.Bw,{children:w.map(e=>(0,t.jsxs)(p.Ql,{value:e.id.toString(),children:[e.part_number," - ",e.descrizione_breve]},e.id))})]})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,t.jsx)(m._,{htmlFor:"tool_id",className:"text-right",children:"Tool"}),(0,t.jsx)("div",{className:"col-span-3",children:(0,t.jsxs)(p.Ph,{value:(null===(r=S.tool_id)||void 0===r?void 0:r.toString())||"",onValueChange:e=>D("tool_id",parseInt(e)),children:[(0,t.jsx)(p.i4,{children:(0,t.jsx)(p.ki,{placeholder:"Seleziona un tool"})}),(0,t.jsx)(p.Bw,{children:v.map(e=>(0,t.jsxs)(p.Ql,{value:e.id.toString(),children:[e.codice," ",e.descrizione?"- ".concat(e.descrizione):""]},e.id))})]})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,t.jsx)(m._,{htmlFor:"priorita",className:"text-right",children:"Priorit\xe0"}),(0,t.jsx)(l.I,{id:"priorita",type:"number",min:1,value:S.priorita||1,onChange:e=>D("priorita",parseInt(e.target.value)),className:"col-span-3"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,t.jsx)(m._,{htmlFor:"status",className:"text-right",children:"Stato"}),(0,t.jsx)("div",{className:"col-span-3",children:(0,t.jsxs)(p.Ph,{value:S.status||"Preparazione",onValueChange:e=>D("status",e),children:[(0,t.jsx)(p.i4,{children:(0,t.jsx)(p.ki,{placeholder:"Seleziona lo stato"})}),(0,t.jsxs)(p.Bw,{children:[(0,t.jsx)(p.Ql,{value:"Preparazione",children:"Preparazione"}),(0,t.jsx)(p.Ql,{value:"Laminazione",children:"Laminazione"}),(0,t.jsx)(p.Ql,{value:"Attesa Cura",children:"Attesa Cura"}),(0,t.jsx)(p.Ql,{value:"Cura",children:"Cura"}),(0,t.jsx)(p.Ql,{value:"Finito",children:"Finito"})]})]})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,t.jsx)(m._,{htmlFor:"note",className:"text-right",children:"Note"}),(0,t.jsx)(g,{id:"note",placeholder:"Note aggiuntive sull'ordine di lavoro",value:S.note||"",onChange:e=>D("note",e.target.value),className:"col-span-3"})]})]}),(0,t.jsxs)(u.cN,{children:[(0,t.jsx)(n.z,{variant:"outline",onClick:c,children:"Annulla"}),(0,t.jsxs)(n.z,{onClick:O,disabled:C,children:[C&&(0,t.jsx)(j,{className:"mr-2 h-4 w-4 animate-spin"}),h?"Aggiorna":"Crea"]})]})]})})};/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let w=f("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),b=e=>({Preparazione:"secondary",Laminazione:"primary","Attesa Cura":"warning",Cura:"destructive",Finito:"success"})[e]||"default";function y(){let[e,i]=(0,a.useState)([]),[r,u]=(0,a.useState)(!0),[p,m]=(0,a.useState)(""),[h,x]=(0,a.useState)({}),[f,v]=(0,a.useState)(!1),[g,y]=(0,a.useState)(null),{toast:z}=(0,s.p)(),C=async()=>{try{u(!0);let e=await d.LD.getAll(h);i(e)}catch(e){console.error("Errore nel caricamento degli ODL:",e),z({variant:"destructive",title:"Errore",description:"Impossibile caricare gli ordini di lavoro. Riprova pi\xf9 tardi."})}finally{u(!1)}};(0,a.useEffect)(()=>{C()},[h]);let _=e=>{y(e),v(!0)},S=async e=>{if(window.confirm("Sei sicuro di voler eliminare l'ODL con ID ".concat(e,"?")))try{await d.LD.delete(e),z({variant:"success",title:"Eliminato",description:"ODL con ID ".concat(e," eliminato con successo.")}),C()}catch(i){console.error("Errore durante l'eliminazione dell'ODL ".concat(e,":"),i),z({variant:"destructive",title:"Errore",description:"Impossibile eliminare l'ODL con ID ".concat(e,".")})}},L=e.filter(e=>{let i=p.toLowerCase();return e.parte.part_number.toLowerCase().includes(i)||e.tool.codice.toLowerCase().includes(i)||e.note&&e.note.toLowerCase().includes(i)});return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Ordini di Lavoro"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Gestisci gli ordini di lavoro in produzione"})]}),(0,t.jsx)(n.z,{onClick:()=>{y(null),v(!0)},children:"Nuovo ODL"})]}),(0,t.jsx)("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:(0,t.jsx)(l.I,{placeholder:"Cerca negli ODL...",value:p,onChange:e=>m(e.target.value),className:"max-w-sm"})}),r?(0,t.jsxs)("div",{className:"flex justify-center py-8",children:[(0,t.jsx)(j,{className:"h-8 w-8 animate-spin"}),(0,t.jsx)("span",{className:"ml-2",children:"Caricamento in corso..."})]}):(0,t.jsxs)(o.iA,{children:[(0,t.jsx)(o.Rn,{children:"Lista degli ordini di lavoro in produzione"}),(0,t.jsx)(o.xD,{children:(0,t.jsxs)(o.SC,{children:[(0,t.jsx)(o.ss,{children:"ID"}),(0,t.jsx)(o.ss,{children:"Part Number"}),(0,t.jsx)(o.ss,{children:"Tool"}),(0,t.jsx)(o.ss,{className:"text-center",children:"Priorit\xe0"}),(0,t.jsx)(o.ss,{className:"text-center",children:"Stato"}),(0,t.jsx)(o.ss,{children:"Note"}),(0,t.jsx)(o.ss,{className:"text-right",children:"Azioni"})]})}),(0,t.jsx)(o.RM,{children:0===L.length?(0,t.jsx)(o.SC,{children:(0,t.jsx)(o.pj,{colSpan:7,className:"text-center py-8",children:"Nessun ordine di lavoro trovato"})}):L.map(e=>(0,t.jsxs)(o.SC,{children:[(0,t.jsx)(o.pj,{className:"font-medium",children:e.id}),(0,t.jsx)(o.pj,{children:(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{children:e.parte.part_number}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground truncate max-w-[200px]",children:e.parte.descrizione_breve})]})}),(0,t.jsx)(o.pj,{children:e.tool.codice}),(0,t.jsx)(o.pj,{className:"text-center",children:(0,t.jsx)(c.C,{variant:e.priorita>5?"destructive":e.priorita>2?"warning":"secondary",children:e.priorita})}),(0,t.jsx)(o.pj,{className:"text-center",children:(0,t.jsx)(c.C,{variant:b(e.status),children:e.status})}),(0,t.jsx)(o.pj,{className:"max-w-[200px] truncate",children:e.note||"-"}),(0,t.jsx)(o.pj,{className:"text-right",children:(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsxs)(n.z,{variant:"outline",size:"sm",onClick:()=>_(e),children:[(0,t.jsx)(w,{className:"h-4 w-4 mr-1"}),"Modifica"]}),(0,t.jsx)(n.z,{variant:"destructive",size:"sm",onClick:()=>S(e.id),children:"Elimina"})]})})]},e.id))})]}),(0,t.jsx)(N,{isOpen:f,onClose:()=>v(!1),item:g,onSuccess:()=>{C(),v(!1)}})]})}},1735:function(e,i,r){"use strict";r.d(i,{Bw:function(){return u},Ph:function(){return o},Ql:function(){return m},i4:function(){return d},ki:function(){return c}});var t=r(7437),a=r(2265),s=r(9394),n=r(2318),l=r(345);let o=n.fC;n.ZA;let c=n.B4,d=a.forwardRef((e,i)=>{let{className:r,children:a,...o}=e;return(0,t.jsxs)(n.xz,{ref:i,className:(0,l.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),...o,children:[a,(0,t.jsx)(n.JO,{asChild:!0,children:(0,t.jsx)(s.jnn,{className:"h-4 w-4 opacity-50"})})]})});d.displayName=n.xz.displayName;let u=a.forwardRef((e,i)=>{let{className:r,children:a,position:s="popper",...o}=e;return(0,t.jsx)(n.h_,{children:(0,t.jsx)(n.VY,{ref:i,className:(0,l.cn)("relative z-50 min-w-[8rem] overflow-hidden rounded-md border bg-background text-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===s&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),position:s,...o,children:(0,t.jsx)(n.l_,{className:(0,l.cn)("p-1","popper"===s&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a})})})});u.displayName=n.VY.displayName;let p=a.forwardRef((e,i)=>{let{className:r,...a}=e;return(0,t.jsx)(n.__,{ref:i,className:(0,l.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",r),...a})});p.displayName=n.__.displayName;let m=a.forwardRef((e,i)=>{let{className:r,children:a,...o}=e;return(0,t.jsxs)(n.ck,{ref:i,className:(0,l.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...o,children:[(0,t.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,t.jsx)(n.wU,{children:(0,t.jsx)(s.nQG,{className:"h-4 w-4"})})}),(0,t.jsx)(n.eT,{children:a})]})});m.displayName=n.ck.displayName;let h=a.forwardRef((e,i)=>{let{className:r,...a}=e;return(0,t.jsx)(n.Z0,{ref:i,className:(0,l.cn)("-mx-1 my-1 h-px bg-muted",r),...a})});h.displayName=n.Z0.displayName},5184:function(e,i,r){"use strict";r.d(i,{D:function(){return a}});var t=r(2265);function a(e){let i=t.useRef({value:e,previous:e});return t.useMemo(()=>(i.current.value!==e&&(i.current.previous=i.current.value,i.current.value=e),i.current.previous),[e])}},4977:function(e,i,r){"use strict";r.d(i,{t:function(){return s}});var t=r(2265),a=r(1030);function s(e){let[i,r]=t.useState(void 0);return(0,a.b)(()=>{if(e){r({width:e.offsetWidth,height:e.offsetHeight});let i=new ResizeObserver(i=>{let t,a;if(!Array.isArray(i)||!i.length)return;let s=i[0];if("borderBoxSize"in s){let e=s.borderBoxSize,i=Array.isArray(e)?e[0]:e;t=i.inlineSize,a=i.blockSize}else t=e.offsetWidth,a=e.offsetHeight;r({width:t,height:a})});return i.observe(e,{box:"border-box"}),()=>i.unobserve(e)}r(void 0)},[e]),i}}},function(e){e.O(0,[310,710,408,318,662,971,472,744],function(){return e(e.s=6910)}),_N_E=e.O()}]);