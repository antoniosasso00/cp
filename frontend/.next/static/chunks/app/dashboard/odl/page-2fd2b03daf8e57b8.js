(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[253],{6910:function(e,t,i){Promise.resolve().then(i.bind(i,1013))},1013:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return D}});var a=i(7437),s=i(2265),r=i(4622),l=i(3089),n=i(6582),o=i(5271),d=i(150),c=i(6454),u=i(1472),p=i(1735),x=i(6429),m=i(6264),h=i(2898);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let f=(0,h.Z)("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);var j=i(345),v=i(6061);let g=(0,v.j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive",warning:"border-yellow-500/50 text-yellow-700 dark:border-yellow-500 [&>svg]:text-yellow-500"}},defaultVariants:{variant:"default"}}),N=s.forwardRef((e,t)=>{let{className:i,variant:s,...r}=e;return(0,a.jsx)("div",{ref:t,role:"alert",className:(0,j.cn)(g({variant:s}),i),...r})});N.displayName="Alert";let w=s.forwardRef((e,t)=>{let{className:i,...s}=e;return(0,a.jsx)("h5",{ref:t,className:(0,j.cn)("mb-1 font-medium leading-none tracking-tight",i),...s})});w.displayName="AlertTitle";let b=s.forwardRef((e,t)=>{let{className:i,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,j.cn)("text-sm [&_p]:leading-relaxed",i),...s})});b.displayName="AlertDescription";let y=s.forwardRef((e,t)=>{let{className:i,...s}=e;return(0,a.jsx)("textarea",{className:(0,j.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",i),ref:t,...s})});y.displayName="Textarea";var _=e=>{var t,i;let{isOpen:o,onClose:d,item:h,onSuccess:j}=e,{toast:v}=(0,r.p)(),[g,w]=(0,s.useState)([]),[_,C]=(0,s.useState)([]),[z,k]=(0,s.useState)([]),[S,L]=(0,s.useState)(null),[D,O]=(0,s.useState)(!1),[A,E]=(0,s.useState)(!1),[P,I]=(0,s.useState)({parte_id:0,tool_id:0,priorita:1,status:"Preparazione",note:""});(0,s.useEffect)(()=>{o&&(R(),h?I({parte_id:h.parte_id,tool_id:h.tool_id,priorita:h.priorita,status:h.status,note:h.note||""}):(I({parte_id:0,tool_id:0,priorita:1,status:"Preparazione",note:""}),L(null),k([])))},[o,h]),(0,s.useEffect)(()=>{if(P.parte_id&&_.length>0){let e=_.find(e=>e.id===P.parte_id);if(L(e||null),e){let t=e.tools||[],i=t.map(e=>e.id),a=g.filter(e=>i.includes(e.id));k(a),P.tool_id&&!i.includes(P.tool_id)&&I(e=>({...e,tool_id:0}))}else k([])}else k([]),L(null)},[P.parte_id,_,g]);let R=async()=>{try{O(!0);let[e,t]=await Promise.all([c.UK.getAll(),c.os.getAll()]);w(e),C(t)}catch(e){console.error("Errore nel caricamento delle dipendenze:",e),v({variant:"destructive",title:"Errore",description:"Impossibile caricare i dati necessari. Riprova pi\xf9 tardi."})}finally{O(!1)}},Z=(e,t)=>{I(i=>({...i,[e]:t}))},F=async()=>{if(!P.parte_id||!P.tool_id){v({variant:"destructive",title:"Validazione fallita",description:"Seleziona una parte e un tool validi."});return}try{E(!0),h?(await c.LD.update(h.id,P),v({variant:"success",title:"ODL aggiornato",description:"ODL #".concat(h.id," aggiornato con successo.")})):(await c.LD.create(P),v({variant:"success",title:"ODL creato",description:"Nuovo ODL creato con successo."})),j()}catch(e){console.error("Errore nel salvataggio dell'ODL:",e),v({variant:"destructive",title:"Errore",description:"Impossibile salvare l'ODL. Verifica i dati e riprova."})}finally{E(!1)}};return(0,a.jsx)(u.Vq,{open:o,onOpenChange:d,children:(0,a.jsxs)(u.cZ,{className:"sm:max-w-[500px]",children:[(0,a.jsxs)(u.fK,{children:[(0,a.jsx)(u.$N,{children:h?"Modifica ODL #".concat(h.id):"Crea nuovo ODL"}),(0,a.jsx)(u.Be,{children:h?"Modifica i dettagli dell'ordine di lavoro":"Inserisci i dettagli per creare un nuovo ordine di lavoro"})]}),D?(0,a.jsxs)("div",{className:"flex justify-center items-center py-8",children:[(0,a.jsx)(m.Z,{className:"h-8 w-8 animate-spin"}),(0,a.jsx)("span",{className:"ml-2",children:"Caricamento in corso..."})]}):(0,a.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(x._,{htmlFor:"parte_id",className:"text-right",children:"Parte"}),(0,a.jsx)("div",{className:"col-span-3",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(p.Ph,{value:(null===(t=P.parte_id)||void 0===t?void 0:t.toString())||"",onValueChange:e=>Z("parte_id",parseInt(e)),children:[(0,a.jsx)(p.i4,{children:(0,a.jsx)(p.ki,{placeholder:"Seleziona una parte"})}),(0,a.jsx)(p.Bw,{children:_.length>0?_.map(e=>(0,a.jsxs)(p.Ql,{value:e.id.toString(),children:[e.part_number," - ",e.descrizione_breve]},e.id)):(0,a.jsx)("div",{className:"px-2 py-4 text-center text-sm",children:"Nessuna parte disponibile"})})]}),(0===P.parte_id||void 0===P.parte_id)&&(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>window.open("/dashboard/parts/new","_blank"),children:"+ Crea nuova parte"})})]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(x._,{htmlFor:"tool_id",className:"text-right",children:"Tool"}),(0,a.jsx)("div",{className:"col-span-3",children:(0,a.jsxs)("div",{className:"space-y-2",children:[S&&0===z.length?(0,a.jsxs)(N,{variant:"warning",className:"mb-2",children:[(0,a.jsx)(f,{className:"h-4 w-4"}),(0,a.jsx)(b,{children:"Nessun tool associato alla parte selezionata"})]}):null,(0,a.jsxs)(p.Ph,{value:(null===(i=P.tool_id)||void 0===i?void 0:i.toString())||"",onValueChange:e=>Z("tool_id",parseInt(e)),disabled:!P.parte_id||0===z.length,children:[(0,a.jsx)(p.i4,{children:(0,a.jsx)(p.ki,{placeholder:"Seleziona un tool"})}),(0,a.jsx)(p.Bw,{children:z.length>0?z.map(e=>(0,a.jsxs)(p.Ql,{value:e.id.toString(),children:[e.codice," ",e.descrizione?"- ".concat(e.descrizione):""]},e.id)):(0,a.jsx)("div",{className:"px-2 py-4 text-center text-sm",children:P.parte_id&&P.parte_id>0?"Nessun tool disponibile per questa parte":"Seleziona prima una parte"})})]}),P.parte_id&&P.parte_id>0&&0===z.length&&(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>{window.open("/dashboard/tools/new","_blank")},children:"+ Crea nuovo tool"})})]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(x._,{htmlFor:"priorita",className:"text-right",children:"Priorit\xe0"}),(0,a.jsx)(n.I,{id:"priorita",type:"number",min:1,value:P.priorita||1,onChange:e=>Z("priorita",parseInt(e.target.value)),className:"col-span-3"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(x._,{htmlFor:"status",className:"text-right",children:"Stato"}),(0,a.jsx)("div",{className:"col-span-3",children:(0,a.jsxs)(p.Ph,{value:P.status||"Preparazione",onValueChange:e=>Z("status",e),children:[(0,a.jsx)(p.i4,{children:(0,a.jsx)(p.ki,{placeholder:"Seleziona lo stato"})}),(0,a.jsxs)(p.Bw,{children:[(0,a.jsx)(p.Ql,{value:"Preparazione",children:"Preparazione"}),(0,a.jsx)(p.Ql,{value:"Laminazione",children:"Laminazione"}),(0,a.jsx)(p.Ql,{value:"Attesa Cura",children:"Attesa Cura"}),(0,a.jsx)(p.Ql,{value:"Cura",children:"Cura"}),(0,a.jsx)(p.Ql,{value:"Finito",children:"Finito"})]})]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(x._,{htmlFor:"note",className:"text-right",children:"Note"}),(0,a.jsx)(y,{id:"note",placeholder:"Note aggiuntive sull'ordine di lavoro",value:P.note||"",onChange:e=>Z("note",e.target.value),className:"col-span-3"})]})]}),(0,a.jsxs)(u.cN,{children:[(0,a.jsx)(l.z,{variant:"outline",onClick:d,children:"Annulla"}),(0,a.jsxs)(l.z,{onClick:F,disabled:A,children:[A&&(0,a.jsx)(m.Z,{className:"mr-2 h-4 w-4 animate-spin"}),h?"Aggiorna":"Crea"]})]})]})})},C=i(7472),z=i(3905),k=i(5367),S=i(9346);let L=e=>({Preparazione:"secondary",Laminazione:"primary","Attesa Cura":"warning",Cura:"destructive",Finito:"success"})[e]||"default";function D(){let[e,t]=(0,s.useState)([]),[i,u]=(0,s.useState)(!0),[p,x]=(0,s.useState)(""),[h,f]=(0,s.useState)({}),[j,v]=(0,s.useState)(!1),[g,N]=(0,s.useState)(null),{toast:w}=(0,r.p)(),b=async()=>{try{u(!0);let e=await c.LD.getAll(h);t(e)}catch(e){console.error("Errore nel caricamento degli ODL:",e),w({variant:"destructive",title:"Errore",description:"Impossibile caricare gli ordini di lavoro. Riprova pi\xf9 tardi."})}finally{u(!1)}};(0,s.useEffect)(()=>{b()},[h]);let y=e=>{N(e),v(!0)},D=async e=>{if(window.confirm("Sei sicuro di voler eliminare l'ODL con ID ".concat(e,"?")))try{await c.LD.delete(e),w({variant:"success",title:"Eliminato",description:"ODL con ID ".concat(e," eliminato con successo.")}),b()}catch(t){console.error("Errore durante l'eliminazione dell'ODL ".concat(e,":"),t),w({variant:"destructive",title:"Errore",description:"Impossibile eliminare l'ODL con ID ".concat(e,".")})}},O=e.filter(e=>{let t=p.toLowerCase();return e.parte.part_number.toLowerCase().includes(t)||e.tool.codice.toLowerCase().includes(t)||e.note&&e.note.toLowerCase().includes(t)});return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Ordini di Lavoro"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Gestisci gli ordini di lavoro in produzione"})]}),(0,a.jsx)(l.z,{onClick:()=>{N(null),v(!0)},children:"Nuovo ODL"})]}),(0,a.jsx)("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:(0,a.jsx)(n.I,{placeholder:"Cerca negli ODL...",value:p,onChange:e=>x(e.target.value),className:"max-w-sm"})}),i?(0,a.jsxs)("div",{className:"flex justify-center py-8",children:[(0,a.jsx)(m.Z,{className:"h-8 w-8 animate-spin"}),(0,a.jsx)("span",{className:"ml-2",children:"Caricamento in corso..."})]}):(0,a.jsxs)(o.iA,{children:[(0,a.jsx)(o.Rn,{children:"Lista degli ordini di lavoro in produzione"}),(0,a.jsx)(o.xD,{children:(0,a.jsxs)(o.SC,{children:[(0,a.jsx)(o.ss,{children:"ID"}),(0,a.jsx)(o.ss,{children:"Part Number"}),(0,a.jsx)(o.ss,{children:"Tool"}),(0,a.jsx)(o.ss,{className:"text-center",children:"Priorit\xe0"}),(0,a.jsx)(o.ss,{className:"text-center",children:"Stato"}),(0,a.jsx)(o.ss,{children:"Note"}),(0,a.jsx)(o.ss,{className:"text-right",children:"Azioni"})]})}),(0,a.jsx)(o.RM,{children:0===O.length?(0,a.jsx)(o.SC,{children:(0,a.jsx)(o.pj,{colSpan:7,className:"text-center py-8",children:"Nessun ordine di lavoro trovato"})}):O.map(e=>(0,a.jsxs)(o.SC,{children:[(0,a.jsx)(o.pj,{className:"font-medium",children:e.id}),(0,a.jsx)(o.pj,{children:(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{children:e.parte.part_number}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground truncate max-w-[200px]",children:e.parte.descrizione_breve})]})}),(0,a.jsx)(o.pj,{children:e.tool.codice}),(0,a.jsx)(o.pj,{className:"text-center",children:(0,a.jsx)(d.C,{variant:e.priorita>5?"destructive":e.priorita>2?"warning":"secondary",children:e.priorita})}),(0,a.jsx)(o.pj,{className:"text-center",children:(0,a.jsx)(d.C,{variant:L(e.status),children:e.status})}),(0,a.jsx)(o.pj,{className:"max-w-[200px] truncate",children:e.note||"-"}),(0,a.jsx)(o.pj,{className:"text-right",children:(0,a.jsxs)(S.h_,{children:[(0,a.jsx)(S.$F,{asChild:!0,children:(0,a.jsx)(l.z,{variant:"ghost",size:"icon",children:(0,a.jsx)(C.Z,{className:"h-4 w-4"})})}),(0,a.jsxs)(S.AW,{align:"end",children:[(0,a.jsxs)(S.Xi,{onClick:()=>y(e),children:[(0,a.jsx)(z.Z,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"Modifica"})]}),(0,a.jsxs)(S.Xi,{onClick:()=>D(e.id),className:"text-destructive focus:text-destructive",children:[(0,a.jsx)(k.Z,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"Elimina"})]})]})]})})]},e.id))})]}),(0,a.jsx)(_,{isOpen:j,onClose:()=>v(!1),item:g,onSuccess:()=>{b(),v(!1)}})]})}},1735:function(e,t,i){"use strict";i.d(t,{Bw:function(){return u},Ph:function(){return o},Ql:function(){return x},i4:function(){return c},ki:function(){return d}});var a=i(7437),s=i(2265),r=i(9394),l=i(6337),n=i(345);let o=l.fC;l.ZA;let d=l.B4,c=s.forwardRef((e,t)=>{let{className:i,children:s,...o}=e;return(0,a.jsxs)(l.xz,{ref:t,className:(0,n.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",i),...o,children:[s,(0,a.jsx)(l.JO,{asChild:!0,children:(0,a.jsx)(r.jnn,{className:"h-4 w-4 opacity-50"})})]})});c.displayName=l.xz.displayName;let u=s.forwardRef((e,t)=>{let{className:i,children:s,position:r="popper",...o}=e;return(0,a.jsx)(l.h_,{children:(0,a.jsx)(l.VY,{ref:t,className:(0,n.cn)("relative z-50 min-w-[8rem] overflow-hidden rounded-md border bg-background text-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",i),position:r,...o,children:(0,a.jsx)(l.l_,{className:(0,n.cn)("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s})})})});u.displayName=l.VY.displayName;let p=s.forwardRef((e,t)=>{let{className:i,...s}=e;return(0,a.jsx)(l.__,{ref:t,className:(0,n.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",i),...s})});p.displayName=l.__.displayName;let x=s.forwardRef((e,t)=>{let{className:i,children:s,...o}=e;return(0,a.jsxs)(l.ck,{ref:t,className:(0,n.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",i),...o,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(l.wU,{children:(0,a.jsx)(r.nQG,{className:"h-4 w-4"})})}),(0,a.jsx)(l.eT,{children:s})]})});x.displayName=l.ck.displayName;let m=s.forwardRef((e,t)=>{let{className:i,...s}=e;return(0,a.jsx)(l.Z0,{ref:t,className:(0,n.cn)("-mx-1 my-1 h-px bg-muted",i),...s})});m.displayName=l.Z0.displayName},5184:function(e,t,i){"use strict";i.d(t,{D:function(){return s}});var a=i(2265);function s(e){let t=a.useRef({value:e,previous:e});return a.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}}},function(e){e.O(0,[310,621,709,936,537,337,934,971,472,744],function(){return e(e.s=6910)}),_N_E=e.O()}]);