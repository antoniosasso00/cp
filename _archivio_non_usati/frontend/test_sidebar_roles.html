<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Sidebar Dinamica - Ruoli CarbonPilot</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .role-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .role-title {
            color: #2563eb;
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 15px;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 10px;
        }
        .section {
            margin: 15px 0;
            padding: 10px;
            background-color: #f8fafc;
            border-left: 4px solid #3b82f6;
        }
        .section-title {
            font-weight: bold;
            color: #1e40af;
            margin-bottom: 8px;
        }
        .menu-item {
            padding: 5px 0;
            color: #374151;
        }
        .visible {
            color: #059669;
            font-weight: 500;
        }
        .hidden {
            color: #dc2626;
            text-decoration: line-through;
            opacity: 0.6;
        }
        .test-controls {
            background: #1f2937;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .role-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
        }
        .role-button:hover {
            background: #2563eb;
        }
        .role-button.active {
            background: #059669;
        }
        .stats {
            background: #ecfdf5;
            border: 1px solid #a7f3d0;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Sidebar Dinamica - Sistema Ruoli CarbonPilot</h1>
        
        <div class="test-controls">
            <h3>Simula Ruolo Utente:</h3>
            <button class="role-button" onclick="testRole('ADMIN')">üëë ADMIN</button>
            <button class="role-button" onclick="testRole('RESPONSABILE')">üë®‚Äçüíº RESPONSABILE</button>
            <button class="role-button" onclick="testRole('LAMINATORE')">üîß LAMINATORE</button>
            <button class="role-button" onclick="testRole('AUTOCLAVISTA')">üî• AUTOCLAVISTA</button>
            <button class="role-button" onclick="testRole(null)">‚ùå NESSUN RUOLO</button>
        </div>

        <div id="sidebar-preview">
            <!-- Il contenuto verr√† generato dinamicamente -->
        </div>
    </div>

    <script>
        // Configurazione sidebar (copiata dal layout.tsx)
        const sidebarSections = [
            {
                title: "Dashboard",
                items: [
                    { title: "Dashboard", href: "/dashboard", roles: null }
                ]
            },
            {
                title: "Gestione ODL",
                items: [
                    { title: "ODL", href: "/dashboard/shared/odl", roles: ['ADMIN', 'RESPONSABILE'] },
                    { title: "Monitoraggio ODL", href: "/dashboard/responsabile/odl-monitoring", roles: ['ADMIN', 'RESPONSABILE'] }
                ],
                roles: ['ADMIN', 'RESPONSABILE']
            },
            {
                title: "Produzione",
                items: [
                    { title: "Produzione", href: "/dashboard/laminatore/produzione", roles: ['ADMIN', 'LAMINATORE'] },
                    { title: "Tools/Stampi", href: "/dashboard/laminatore/tools", roles: ['ADMIN', 'LAMINATORE'] }
                ],
                roles: ['ADMIN', 'LAMINATORE']
            },
            {
                title: "Autoclave",
                items: [
                    { title: "Nesting", href: "/dashboard/autoclavista/nesting", roles: ['ADMIN', 'AUTOCLAVISTA'] },
                    { title: "Autoclavi", href: "/dashboard/autoclavista/autoclavi", roles: ['ADMIN', 'AUTOCLAVISTA'] },
                    { title: "Reports", href: "/dashboard/responsabile/reports", roles: ['ADMIN', 'AUTOCLAVISTA'] }
                ],
                roles: ['ADMIN', 'AUTOCLAVISTA']
            },
            {
                title: "Pianificazione",
                items: [
                    { title: "Schedule", href: "/dashboard/autoclavista/schedule", roles: ['ADMIN', 'RESPONSABILE'] }
                ],
                roles: ['ADMIN', 'RESPONSABILE']
            },
            {
                title: "Amministrazione",
                items: [
                    { title: "Catalogo", href: "/dashboard/shared/catalog", roles: ['ADMIN'] },
                    { title: "Parti", href: "/dashboard/laminatore/parts", roles: ['ADMIN'] },
                    { title: "Cicli Cura", href: "/dashboard/autoclavista/cicli-cura", roles: ['ADMIN'] },
                    { title: "Statistiche", href: "/dashboard/responsabile/statistiche", roles: ['ADMIN'] },
                    { title: "Tempi & Performance", href: "/dashboard/laminatore/tempi", roles: ['ADMIN'] },
                    { title: "Impostazioni", href: "/dashboard/admin/impostazioni", roles: ['ADMIN'] }
                ],
                roles: ['ADMIN']
            }
        ];

        // Logica di filtraggio (copiata dal layout.tsx)
        function filterItemsByRole(items, role) {
            return items.filter(item => {
                if (!item.roles) return true;
                if (!role) return false;
                return item.roles.includes(role);
            });
        }

        function filterSectionsByRole(sections, role) {
            return sections
                .map(section => ({
                    ...section,
                    items: filterItemsByRole(section.items, role)
                }))
                .filter(section => {
                    if (!section.roles) return section.items.length > 0;
                    if (!role) return false;
                    return section.roles.includes(role) && section.items.length > 0;
                });
        }

        function testRole(role) {
            // Aggiorna pulsanti attivi
            document.querySelectorAll('.role-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Simula localStorage
            if (role) {
                localStorage.setItem('userRole', role);
            } else {
                localStorage.removeItem('userRole');
            }

            // Filtra sezioni
            const filteredSections = filterSectionsByRole(sidebarSections, role);
            
            // Genera preview
            let html = `<div class="role-section">`;
            html += `<div class="role-title">üé≠ Ruolo Attivo: ${role || 'NESSUNO'}</div>`;
            
            if (filteredSections.length === 0) {
                html += `<div style="text-align: center; color: #dc2626; padding: 40px;">
                    <h3>‚ùå Nessuna funzionalit√† disponibile</h3>
                    <p>L'utente deve selezionare un ruolo valido</p>
                </div>`;
            } else {
                filteredSections.forEach(section => {
                    html += `<div class="section">`;
                    html += `<div class="section-title">üìÅ ${section.title}</div>`;
                    section.items.forEach(item => {
                        html += `<div class="menu-item visible">‚úÖ ${item.title}</div>`;
                    });
                    html += `</div>`;
                });
            }

            // Statistiche
            const totalItems = sidebarSections.reduce((acc, section) => acc + section.items.length, 0);
            const visibleItems = filteredSections.reduce((acc, section) => acc + section.items.length, 0);
            
            html += `<div class="stats">
                <strong>üìä Statistiche Accesso:</strong><br>
                Voci totali disponibili: ${totalItems}<br>
                Voci visibili per questo ruolo: ${visibleItems}<br>
                Percentuale accesso: ${Math.round((visibleItems / totalItems) * 100)}%
            </div>`;
            
            html += `</div>`;
            
            document.getElementById('sidebar-preview').innerHTML = html;
        }

        // Test iniziale con ADMIN
        window.onload = () => {
            testRole('ADMIN');
        };
    </script>
</body>
</html> 